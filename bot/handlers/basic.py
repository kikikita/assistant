import httpx
from aiogram import Router
from aiogram.enums import ParseMode
from aiogram.filters import Command
from aiogram.types import Message

from keyboards.reply import get_main_kb, remove_kb
from settings import settings

router = Router()


@router.message(Command("start"))
async def start_command(message: Message):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±—ç–∫—ç–Ω–¥–µ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –µ–≥–æ."""
    url = f"{settings.bots.app_url}/api/v1/auth/tg"
    payload = {"tg_id": message.from_user.id}

    async with httpx.AsyncClient(timeout=5.0) as client:
        resp = await client.post(url, json=payload)

    if resp.status_code != 200:
        await message.answer("‚ö†Ô∏è –°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.")
        return

    welcome = (
        f"üëã –ü—Ä–∏–≤–µ—Ç, <b>{message.from_user.first_name}</b>!\n\n"
        "–Ø ‚Äî —É–º–Ω—ã–π HR-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Tomoru.Team. "
        "–í –¥–∏–∞–ª–æ–≥–æ–≤–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Å–æ—Å—Ç–∞–≤–∏—Ç—å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –∏ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—Ç—ã.\n\n"
        "–ß—Ç–æ —è —É–º–µ—é:\n"
        "‚Ä¢ –í–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥ –∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å, —á—Ç–æ –∏ –∫–∞–∫ –ª—É—á—à–µ –Ω–∞–ø–∏—Å–∞—Ç—å\n"
        "‚Ä¢ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∞—É–¥–∏–æ-—Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–∏–∫—Ç—É–π —Å–≤–æ–π –æ—Ç–≤–µ—Ç\n"
        "‚Ä¢ –ü—Ä–∏–Ω–∏–º–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ä–µ–∑—é–º–µ –≤ PDF ‚Äî —è —Å–∞–º –∏–∑–≤–ª–µ–∫—É –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é\n\n"
        "–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö, –Ω–∞–∂–º–∏ /help\n"
        "–î–ª—è —Å—Ç–∞—Ä—Ç–∞ ‚Äî –∂–º–∏ –∫–Ω–æ–ø–∫—É <b>–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∑—é–º–µ</b> –∏–ª–∏ –Ω–∞–ø–∏—à–∏ –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å."
    )
    await message.answer(welcome, parse_mode=ParseMode.HTML,
                         reply_markup=get_main_kb())


@router.message(Command(commands=["help"]))
async def help_command(message: Message):
    help_message = (
        "‚ÑπÔ∏è <b>–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è HR-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–º Tomoru.Team:</b>\n\n"
        "<b>1. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–∑—é–º–µ</b>\n"
        "‚Äî –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∑—é–º–µ</b> –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.\n"
        "‚Äî –Ø –±—É–¥—É –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –ü—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –Ω–∏—Ö, —á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã.\n\n"
        "<b>2. –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è</b>\n"
        "‚Äî –ú–æ–∂–µ—Ç–µ –Ω–∞–¥–∏–∫—Ç–æ–≤—ã–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –≥–æ–ª–æ—Å–æ–º. –Ø —Ä–∞—Å–ø–æ–∑–Ω–∞—é —Ä–µ—á—å –∏ –æ–±—Ä–∞–±–æ—Ç–∞—é –≤–∞—à –æ—Ç–≤–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç.\n\n"
        "<b>3. –ó–∞–≥—Ä—É–∑–∫–∞ PDF</b>\n"
        "‚Äî –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ä–µ–∑—é–º–µ –≤ PDF ‚Äî –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–≥–æ —Å—é–¥–∞, –∏ —è —Å–∞–º –∑–∞–ø–æ–ª–Ω—é –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è.\n\n"
        "<b>4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—é–º–µ</b>\n"
        "‚Äî –ß—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –ª—é–±—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ: "
        "\"–ò–∑–º–µ–Ω–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞\" –∏–ª–∏ \"–û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ\" ‚Äî —è –ø–æ–º–æ–≥—É —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ–µ –ø–æ–ª–µ.\n\n"
        "<b>5. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ä–µ–∑—é–º–µ</b>\n"
        "‚Äî –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.\n\n"
        "<b>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</b>\n"
        "/start ‚Äî –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∑–∞–Ω–æ–≤–æ\n"
        "/help ‚Äî –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n\n"
        "‚ùì <b>–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ!</b>"
    )
    await message.answer(
            help_message,
            parse_mode=ParseMode.HTML,
            reply_markup=remove_kb
            )
